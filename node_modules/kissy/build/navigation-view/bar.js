modulex.add("navigation-view/bar",["xtemplate/runtime","component/control","button"],function(t,e,n){var a,i,s,r=t("xtemplate/runtime"),o=t("component/control"),l=t("button");a=function(t){var e=t=function a(t){function e(t,e,i){var s=t.data,r=t.affix;e.data+='\r\n<div class="',o.line=2;var l;l=u(a,t,{escape:1,params:["title-wrap"]},e,["getBaseCssClasses"]),e=e.writeEscaped(l),e.data+='">\r\n    <div class="',o.line=3;var c;c=u(a,t,{escape:1,params:["title"]},e,["getBaseCssClasses"]),e=e.writeEscaped(c),e.data+='">';var f=(n=r.title)!==i?n:(n=s.title)!==i?n:t.resolveLooseUp(["title"]);return e=e.writeEscaped(f),e.data+="</div>\r\n</div>\r\n",e}{var n,a=this,i=a.root,s=a.buffer,r=a.scope,o=(a.runtime,a.name,a.pos),l=r.data,c=r.affix,f=i.nativeCommands,h=i.utils,u=h.callFn,d=(h.callCommand,f.range,f.foreach,f.forin,f.each,f["with"],f["if"]);f.set,f.include,f.parse,f.extend,f.block,f.macro,f["debugger"]}s.data+="",o.line=1;var g=(n=c.withTitle)!==t?n:(n=l.withTitle)!==t?n:r.resolveLooseUp(["withTitle"]);s=d.call(a,r,{params:[g],fn:e},s),s.data+='\r\n<div class="',o.line=6;var v;v=u(a,r,{escape:1,params:["content"]},s,["getBaseCssClasses"]),s=s.writeEscaped(v),s.data+='">\r\n    <div class="',o.line=7;var p;return p=u(a,r,{escape:1,params:["center"]},s,["getBaseCssClasses"]),s=s.writeEscaped(p),s.data+='"></div>\r\n</div>',s};return e.TPL_NAME=n.id||n.name,t}(),i=function(t){var e=a,n=r,i=new n(e);return t=function(){return i.render.apply(i,arguments)}}(),s=function(t){function e(t){var e,n;e=t.clone(!0),e[0].id=t[0].id+"-proxy",t.parent().append(e);var a=t.offset();return e.css("position","absolute"),e.offset(a),e.css({width:n=t.css("width"),height:t.css("height")}),e}function n(t,e,n){t.animate(e,{duration:.25,easing:"ease-in-out",complete:n})}function a(t,e,n,a){var i,s,r,o,l,c,f=t.get("el"),h=t.get("titleEl"),u=Math.min(f[0].offsetWidth/3,200),d=e[0].offsetWidth,g=f[0].offsetWidth,v=h.offset().left-f.offset().left,p=h[0].offsetWidth,m=n.width;return a?(i=-m,s=Math.min(v-m,u)):(s=-m,i=Math.min(v,u)),r={element:{from:{transform:"translateX("+i+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+s+"px) translateZ(0)",opacity:0}}},c=-v+d,p>v&&(l=-v-p),a?(s=g-v-p,i=void 0!==l?l:c):(i=g-v-p,s=void 0!==l?l:c,i=Math.max(0,i)),o={element:{from:{transform:"translateX("+i+"px) translateZ(0)"},to:{transform:"translateX(0) translateZ(0)",opacity:1}},ghost:{to:{transform:"translateX("+s+"px) translateZ(0)",opacity:0}}},{back:r,title:o}}function s(){this.fire("backward")}function r(){this.get("navigationView").pop()}function c(t){this.set("title",t.newView.get("title")||"")}function f(t){var e=this,n=t.oldView,a=t.newView,i=t.backward;n&&e[i?"backward":"forward"](a.get("title")||"")}var h=o,u=l,d=i;return t=h.extend({initializer:function(){this._withTitle=this.get("withTitle"),this._stack=[],this.publish("backward",{defaultFn:r,defaultTargetOnly:!0})},renderUI:function(){var t=this,e=t.get("prefixCls");t._buttons={},t.get("withBackButton")&&(t._backBtn=new u({prefixCls:e+"navigation-bar-",elCls:e+"navigation-bar-backward",elBefore:t.get("contentEl")[0].firstChild,visible:!1,content:t.get("backText")}).render())},bindUI:function(){this._backBtn&&this._backBtn.on("click",s,this);var t=this.get("navigationView");t.on("afterInnerViewChange",c,this),t.on("beforeInnerViewChange",f,this)},addButton:function(t,e){var n=this,a=n.get("prefixCls");if(e.prefixCls=a+"navigation-bar-",!e.elBefore&&!e.render){var i=e.align=e.align||"left";"left"===i?e.elBefore=n.get("centerEl"):"right"===i&&(e.render=n.get("contentEl")),delete e.align}return n._buttons[t]=new u(e).render(),n._buttons[t]},insertButtonBefore:function(t,e,n){return e.elBefore=n.get("el"),this.addButton(t,e)},removeButton:function(t){this._buttons[t].destroy(),delete this._buttons[t]},getButton:function(t){return this._buttons[t]},forward:function(t){this._stack.push(t),this.go(t,!0)},go:function(t,i,s){var r=this,o=r._backBtn;if(!o||!r._withTitle)return r._withTitle&&r.get("titleEl").html(t),o&&o[i?"show":"hide"](),void 0;var l=o.get("el");l.stop(!0),r.ghostBackEl&&r.ghostBackEl.stop(!0);var c={width:l[0].offsetWidth},f=e(l);r.ghostBackEl=f,l.css("opacity",0),o[i?"show":"hide"](),r.ghostBackEl&&r.ghostBackEl.stop(!0);var h=a(r,l,c,s);l.css(h.back.element.from),o.get("visible")&&n(l,h.back.element.to),"none"!==f.css("display")?n(f,h.back.ghost.to,function(){f.remove(),r.ghostBackEl=null}):(f.remove(),r.ghostBackEl=null);var u=r.get("titleEl");u.stop(!0);var d=e(u.parent());r.ghostTitleEl=d,u.css("opacity",0),r.set("title",t),u.css(h.title.element.from),n(u,h.title.element.to),n(d,h.title.ghost.to,function(){d.remove(),r.ghostTitleEl=null})},backward:function(t){this._stack.length&&(this._stack.pop(),this.go(t,this._stack.length,!0))},_onSetTitle:function(t){var e=this.get("titleEl");e&&e.html(t)},_onSetBackText:function(t){this._backBtn&&this._backBtn.set("content",t)}},{xclass:"navigation-bar",ATTRS:{handleGestureEvents:{value:!1},focusable:{value:!1},allowTextSelection:{value:!0},contentTpl:{value:d},centerEl:{selector:function(){return"."+this.getBaseCssClass("center")}},contentEl:{selector:function(){return"."+this.getBaseCssClass("content")}},titleEl:{selector:function(){return"."+this.getBaseCssClass("title")}},title:{value:"",render:1,sync:0},withBackButton:{value:1},withTitle:{value:1,render:1,sync:0},backText:{value:"Back",render:1,sync:0}}})}(),n.exports=s});