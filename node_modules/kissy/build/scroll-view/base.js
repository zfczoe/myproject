modulex.add("scroll-view/base",["anim/timer","component/container","component/extension/content-box","node","feature","util"],function(t,l,e){var o,n=t("anim/timer"),r=t("component/container"),s=t("component/extension/content-box"),i=t("node"),c=t("feature"),a=t("util");o=function(t){function l(){var t=this,l=t.el,e=l.scrollTop,o=l.scrollLeft;e&&t.set("scrollTop",e+t.get("scrollTop")),o&&t.set("scrollLeft",o+t.get("scrollLeft")),l.scrollTop=l.scrollLeft=0}function e(t,l){t.scrollView.set(l.prop,l.val)}function o(t,l){var e,o=this,n=o.$contentEl,r=t.scrollHeight,s=t.scrollWidth,i=t.clientHeight,c=t.clientWidth,a=l&&l.prevVal||{};if(a.scrollHeight!==r||a.scrollWidth!==s||i!==a.clientHeight||c!==a.clientWidth){o.scrollHeight=r,o.scrollWidth=s,o.clientHeight=i,o.clientWidth=c,e=o.allowScroll={},r>i&&(e.top=1),s>c&&(e.left=1),o.minScroll={left:0,top:0};var f,h;o.maxScroll={left:f=s-c,top:h=r-i},delete o.scrollStep;var p=o.get("snap"),u=o.get("scrollLeft"),d=o.get("scrollTop");if(p){var g=n.offset(),v=o.pages="string"==typeof p?n.all(p):n.children(),m=o.get("pageIndex"),T=o.pagesOffset=[];if(v.each(function(t,l){var e=t.offset(),o=e.left-g.left,n=e.top-g.top;f>=o&&h>=n&&(T[l]={left:o,top:n,index:l})}),m)return o.scrollToPage(m),void 0}o.scrollToWithBounds({left:u,top:d}),o.fire("reflow",t)}}var f,h=n,p=r,u=s,d=i,g=d.Event.KeyCode,v=c,m=v.getCssVendorInfo("transform"),T=Math.floor,S=v.isTransform3dSupported(),x=!!m,W=a,L={initializer:function(){this.scrollAnims=[]},bindUI:function(){var t=this,e=t.$el;e.on("mousewheel",t.handleMouseWheel,t).on("scroll",l,t)},syncUI:function(){this.sync()},sync:function(){var t=this,l=t.el,e=t.contentEl,o=Math.max(e.offsetHeight,e.scrollHeight),n=Math.max(e.offsetWidth,e.scrollWidth),r=l.clientHeight,s=l.clientWidth;t.set("dimension",{scrollHeight:o,scrollWidth:n,clientWidth:s,clientHeight:r})},_onSetDimension:o,handleKeyDownInternal:function(t){var l=t.target,e=d(l),o=e.nodeName();if("input"===o||"textarea"===o||"select"===o||e.hasAttr("contenteditable"))return void 0;var n,r=this,s=t.keyCode,i=r.getScrollStep(),c=r.allowScroll.left,a=r.allowScroll.top;if(a){var f=i.top,h=r.clientHeight,p=r.get("scrollTop");s===g.DOWN?(r.scrollToWithBounds({top:p+f}),n=!0):s===g.UP?(r.scrollToWithBounds({top:p-f}),n=!0):s===g.PAGE_DOWN?(r.scrollToWithBounds({top:p+h}),n=!0):s===g.PAGE_UP&&(r.scrollToWithBounds({top:p-h}),n=!0)}if(c){var u=i.left,v=r.get("scrollLeft");s===g.RIGHT?(r.scrollToWithBounds({left:v+u}),n=!0):s===g.LEFT&&(r.scrollToWithBounds({left:v-u}),n=!0)}return n},getScrollStep:function(){var t=this;if(t.scrollStep)return t.scrollStep;var l=d(this.get("el")[0].ownerDocument),e=t.clientHeight,o=t.clientWidth;return t.scrollStep={top:Math.max(e*e*.7/l.height(),20),left:Math.max(o*o*.7/l.width(),20)},t.scrollStep},handleMouseWheel:function(t){if(!this.get("disabled")){var l,e,o,n,r=this,s=r.getScrollStep(),i=r.maxScroll,c=r.minScroll;if((o=t.deltaY)&&r.allowScroll.top){var a=r.get("scrollTop");l=i.top,e=c.top,e>=a&&o>0||a>=l&&0>o||(r.scrollToWithBounds({top:a-t.deltaY*s.top}),t.preventDefault())}if((n=t.deltaX)&&r.allowScroll.left){var f=r.get("scrollLeft");l=i.left,e=c.left,e>=f&&n>0||f>=l&&0>n||(r.scrollToWithBounds({left:f-t.deltaX*s.left}),t.preventDefault())}}},stopAnimation:function(){var t=this;t.scrollAnims.length&&(W.each(t.scrollAnims,function(t){t.stop()}),t.scrollAnims=[]),t.scrollToWithBounds({left:t.get("scrollLeft"),top:t.get("scrollTop")})},_uiSetPageIndex:function(t){this.scrollToPage(t)},getPageIndexFromXY:function(t,l,e){var o,n,r=this.pagesOffset.concat([]),s=l?"left":"top";if(r.sort(function(t,l){return t[s]-l[s]}),e>0){for(o=0;o<r.length;o++)if(n=r[o],n[s]>=t)return n.index}else for(o=r.length-1;o>=0;o--)if(n=r[o],n[s]<=t)return n.index;return void 0},scrollToPage:function(t,l){var e,o=this;(e=o.pagesOffset)&&e[t]&&(o.set("pageIndex",t),o.scrollTo(e[t],l))},scrollToWithBounds:function(t,l){var e=this,o=e.maxScroll,n=e.minScroll;t.left&&(t.left=Math.min(Math.max(t.left,n.left),o.left)),t.top&&(t.top=Math.min(Math.max(t.top,n.top),o.top)),e.scrollTo(t,l)},scrollTo:function(t,l){var o=this,n=t.left,r=t.top;if(l){var s={},i={};void 0!==n&&(i.scrollLeft=n,s.scrollLeft=o.get("scrollLeft")),void 0!==r&&(i.scrollTop=r,s.scrollTop=o.get("scrollTop")),l.frame=e,l.node=s,l.to=i;var c;o.scrollAnims.push(c=new h(l)),c.scrollView=o,c.run()}else void 0!==n&&o.set("scrollLeft",n),void 0!==r&&o.set("scrollTop",r)},_onSetScrollLeft:function(t){this.contentEl.style.left=-t+"px"},_onSetScrollTop:function(t){this.contentEl.style.top=-t+"px"}};return x&&(f=m.propertyName,L._onSetScrollLeft=function(t){this.contentEl.style[f]="translateX("+T(0-t)+"px) translateY("+T(0-this.get("scrollTop"))+"px)"+(S?" translateZ(0)":"")},L._onSetScrollTop=function(t){this.contentEl.style[f]="translateX("+T(0-this.get("scrollLeft"))+"px) translateY("+T(0-t)+"px)"+(S?" translateZ(0)":"")}),t=p.extend([u],L,{version:"1.0.1",ATTRS:{focusable:{value:!0},allowTextSelection:{value:!0},handleGestureEvents:{value:!1},scrollLeft:{render:1,value:0},scrollTop:{render:1,value:0},dimension:{},snap:{value:!1},pageIndex:{value:0}},xclass:"scroll-view"})}(),e.exports=o});