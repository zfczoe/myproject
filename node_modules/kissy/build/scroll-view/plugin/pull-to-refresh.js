modulex.add("scroll-view/plugin/pull-to-refresh",["base","util","node","feature"],function(l,e,t){var o,n=l("base"),r=l("util"),a=l("node"),i=l("feature");o=function(l){function e(l,e,t){l.isLoading="loading"===e;var o=l.scrollView.get("prefixCls"),n=l.get$El(t);n.attr("class",o+"scroll-view-pull-"+t+"-to-refresh "+o+"scroll-view-"+e),l.get$LabelEl(t).html(l.getStateHtml(t,e))}var t=n,o=r,p=a,u=r.substitute,s=i.getCssVendorInfo("transform"),g=s&&s.propertyName;return l=t.extend({pluginId:this.name,get$El:function(l){return this["$"+l+"El"]},getEl:function(l){return this.get$El(l)[0]},get$LabelEl:function(l){return this["$"+l+"LabelEl"]},getStateHtml:function(l,e){return l=o.ucfirst(l),this.get(e+l+"Html")},_onSetPullUpState:function(l){e(this,l,"up")},_onSetPullDownState:function(l){e(this,l,"down")},_onScrollMove:function(){var l=this;if(!l.isLoading){var e=l.scrollView.get("scrollTop");0>e?l.get$El("down")&&l.set("pullDownState",e>-l.pulldownElHeight?"pulling":"releasing"):e>l.scrollView.maxScroll.top&&l.get$El("up")&&l.set("pullUpState",e<l.scrollView.maxScroll.top+l.pullupElHeight?"pulling":"releasing")}},_onDragEnd:function(){var l=this;if(!l.isLoading){var e,t,o=l.scrollView,n=o.get("scrollTop");l.get$El("down")&&n<-l.pulldownElHeight?(o.minScroll.top=-l.pulldownElHeight,e=l.get("pullDownLoadFn"),l.set("pullDownState","loading"),t=function(){o.scrollTo({top:-l.pulldownElHeight}),o.scrollTo({top:o.minScroll.top},{duration:o.get("snapDuration"),easing:o.get("snapEasing")}),l.set("pullDownState","pulling")}):l.get$El("up")&&n>o.maxScroll.top+l.pullupElHeight&&(o.maxScroll.top+=l.pullupElHeight,e=l.get("pullUpLoadFn"),l.set("pullUpState","loading"),t=function(){o.scrollTo({top:o.maxScroll.top+l.pullupElHeight}),o.scrollTo({top:o.maxScroll.top},{duration:o.get("snapDuration"),easing:o.get("snapEasing")}),l.set("pullUpState","pulling")}),e&&e.call(l,t)}},_onSetScrollTop:function(l){l=l.newVal;var e=this;if(e.get$El("down")&&0>l&&(e.getEl("down").style[g]="translate3d(0,"+-l+"px,0)"),e.get$El("up")){var t=e.scrollView.maxScroll.top;e.isLoading&&(t-=e.pullupElHeight),l>t&&(e.getEl("up").style[g]="translate3d(0,"+(t-l)+"px,0)")}},pluginRenderUI:function(l){var e=this;e.scrollView=l;var t=[];e.get("pullUpLoadFn")&&t.push("up"),e.get("pullDownLoadFn")&&t.push("down");var n=l.get("prefixCls");o.each(t,function(t){var o=p(u('<div class="{prefixCls}scroll-view-pull-{d}-to-refresh" ontouchmove="return false;"><div class="{prefixCls}scroll-view-pull-{d}-to-refresh-content"><span class="{prefixCls}scroll-view-pull-{d}-icon"></span><span class="{prefixCls}scroll-view-pull-{d}-label"></span></div></div>',{prefixCls:n,d:t}));e["$"+t+"LabelEl"]=o.one("."+n+"scroll-view-pull-"+t+"-label"),l.get("el").prepend(o),e["$"+t+"El"]=o,e["pull"+t+"ElHeight"]=o.height()})},pluginBindUI:function(l){var e=this;l.on("touchMove",e._onScrollMove,e),l.on("touchEnd",e._onDragEnd,e),l.on("afterScrollTopChange",e._onSetScrollTop,e)},pluginDestructor:function(l){var e=this;e.get$El("up")&&e.get$El("up").remove(),e.get$El("down")&&e.get$El("down").remove(),l.detach("touchMove",e._onScrollMove,e),l.detach("touchEnd",e._onDragEnd,e),l.detach("afterScrollTopChange",e._onSetScrollTop,e)}},{ATTRS:{pullingDownHtml:{value:"Pull down to refresh..."},pullingUpHtml:{value:"Pull up to refresh..."},releasingUpHtml:{value:"release to refresh..."},releasingDownHtml:{value:"release to refresh..."},loadingUpHtml:{value:"loading..."},loadingDownHtml:{value:"loading..."},pullUpLoadFn:{},pullDownLoadFn:{},pullUpState:{},pullDownState:{}}})}(),t.exports=o});