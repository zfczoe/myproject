modulex.add("overlay",["node","ua","event-dom/gesture/tap","util","xtemplate/runtime","component/container","component/extension/shim","component/extension/align","component/extension/content-box"],function(e,t,n){var a,o,r,s,i,l,c,d,u,f,v,p=e("node"),h=e("ua"),g=e("event-dom/gesture/tap"),m=e("util"),y=e("xtemplate/runtime"),x=e("component/container"),b=e("component/extension/shim"),C=e("component/extension/align"),_=e("component/extension/content-box");a=function(e){function t(){}var n=p;return t.prototype={loading:function(){var e=this;e._loadingExtEl||(e._loadingExtEl=n('<div class="'+e.get("prefixCls")+'ext-loading" style="position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);"/>').appendTo(e.$el)),e._loadingExtEl.show()},unloading:function(){this._loadingExtEl&&this._loadingExtEl.hide()}},e=t}(),o=function(e){function t(){return c?"expression(KISSY.DOM.docWidth())":"100%"}function n(){return c?"expression(KISSY.DOM.docHeight())":"100%"}function a(e,a){var o=e.getBaseCssClasses("mask"),r=d('<div  style="width:'+t()+";left:0;top:0;height:"+n()+";position:"+(c?"absolute":"fixed")+';" class="'+o+" "+a+'">'+(c?'<iframe style="position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;"></iframe>':"")+"</div>").prependTo("body");return r.unselectable(),r.on("mousedown",function(e){e.preventDefault()}),r}function o(){}function r(e,t){var n=e.get("maskNode"),a=e.getBaseCssClasses("mask-hidden");t?n.removeClass(a):n.addClass(a)}function s(e,t,n,a){var o=e.effect||v;if(r(a,n),o!==v){var s,i=e.duration,l=e.easing,c=n?1:0;t.stop(1,1),t.css("display",n?v:"block"),s=o+m[o][c],t[s](i,function(){t.css("display","")},l)}}function i(e){var t,n=this,a=n.get("maskNode");if(t=e.newVal){var o=Number(n.$el.css("z-index"));isNaN(o)||a.css("z-index",o)}s(n.get("mask"),a,t,n)}var l=h,c=6===l.ie,d=p,u=g,f=u.TAP;o.ATTRS={mask:{value:!1},maskNode:{}};var v="none",m={fade:["Out","In"],slide:["Up","Down"]};return o.prototype={__renderUI:function(){var e=this;e.get("mask")&&e.set("maskNode",a(e,e.get("visible")?"":e.getBaseCssClasses("mask-hidden")))},__bindUI:function(){var e,t,n=this;(t=n.get("mask"))&&(e=n.get("maskNode"),t.closeOnClick&&e.on(f,n.close,n),n.on("afterVisibleChange",i))},__destructor:function(){var e;(e=this.get("maskNode"))&&e.remove()}},e=o}(),r=function(e){function t(e){var t=e.$el,n=t.clone(!0);return n.css({visibility:"hidden",overflow:"hidden"}).addClass(e.get("prefixCls")+"overlay-ghost"),e.__afterCreateEffectGhost(n)}function n(e,n){e.__effectGhost&&e.__effectGhost.stop(1,1);var a,o,r,s,l=e.$el,c=p,d=e.get("effect"),u=c(d.target),f=d.duration,v={width:u.width(),height:u.height()},h=u.offset(),g={width:l.width(),height:l.height()},m=l.offset(),y=t(e),x=d.easing;y.insertAfter(l),n?(a=v,r=h,o=g,s=m):(a=g,r=m,o=v,s=h),y.offset(s),i.mix(o,{left:y.css("left"),top:y.css("top")}),l.css("visibility","hidden"),y.css(a),y.offset(r),e.__effectGhost=y,y.css("visibility","visible"),y.animate(o,{Anim:d.Anim,duration:f,easing:x,complete:function(){e.__effectGhost=null,y.remove(),l.css("visibility","")}})}function a(e,t){var a=e.$el,o=e.get("effect"),r=o.effect||"none",i=o.target;if("none"!==r||i){if(i)return n(e,t),void 0;var l=o.duration,c=o.easing,d=t?1:0;a.stop(1,1),a.css({visibility:"visible",display:t?"none":"block"});var u=r+s[r][d];a[u]({duration:l,Anim:o.Anim,complete:function(){a.css({display:"block",visibility:""})},easing:c})}}function o(e){a(this,e.newVal)}function r(){}var s={fade:["Out","In"],slide:["Up","Down"]},i=m;return r.ATTRS={effect:{valueFn:function(){return{effect:"",target:null,duration:.5,easing:"easeOut"}},setter:function(e){var t=e.effect;"string"!=typeof t||s[t]||(e.effect="")}}},r.prototype={__afterCreateEffectGhost:function(e){return e},__bindUI:function(){this.on("afterVisibleChange",o,this)}},e=r}(),s=function(e){var t=e=function(){function e(e,t,n){var r=e.data,s=e.affix;t.data+='\r\n        <a href="javascript:void(\'close\')"\r\n           aria-label="Close"\r\n           class="',l.line=5;var i;i=u(o,e,{escape:1,params:["close"]},t,["getBaseCssClasses"]),t=t.writeEscaped(i),t.data+="\"\r\n           role='button'>\r\n            <span class=\"",l.line=7;var c;c=u(o,e,{escape:1,params:["close-x"]},t,["getBaseCssClasses"]),t=t.writeEscaped(c),t.data+='">';var d=(a=s.closeText)!==n?a:(a=r.closeText)!==n?a:e.resolveLooseUp(["closeText"]);return t=t.write(d),t.data+="</span>\r\n        </a>\r\n    ",t}function t(t,n,r){var s=t.data,i=t.affix;n.data+="\r\n    ",l.line=2,l.line=2;var c=(a=i.closable)!==r?a:(a=s.closable)!==r?a:t.resolveLooseUp(["closable"]);return n=f.call(o,t,{params:[c],fn:e},n),n.data+="\r\n",n}function n(e,t,n){var o=e.data,r=e.affix;t.data+="\r\n        ",l.line=14;var s=(a=r.content)!==n?a:(a=o.content)!==n?a:e.resolveLooseUp(["content"]);return t=t.write(s),t.data+="\r\n    ",t}{var a,o=this,r=o.root,s=o.buffer,i=o.scope,l=(o.runtime,o.name,o.pos),c=(i.data,i.affix,r.nativeCommands),d=r.utils,u=d.callFn,f=(d.callCommand,c.range,c.foreach,c.forin,c.each,c["with"],c["if"]),v=(c.set,c.include,c.parse,c.extend,c.block);c.macro,c["debugger"]}s.data+="",l.line=1,s=v.call(o,i,{params:["ks-overlay-closable"],fn:t},s),s.data+='\r\n\r\n<div class="',l.line=12;var p;return p=u(o,i,{escape:1,params:["content"]},s,["getBaseCssClasses"]),s=s.writeEscaped(p),s.data+='">\r\n    ',l.line=13,s=v.call(o,i,{params:["ks-overlay-content"],fn:n},s),s.data+="\r\n</div>",s};return t.TPL_NAME=n.id||n.name,e}(),i=function(e){var t=e=function(){function e(e,t,n){var a=e.data,r=e.affix;t.data+="\r\n ",u.line=6;var s=(o=r.xindex)!==n?o:(o=a.xindex)!==n?o:e.resolveLooseUp(["xindex"]);t=t.writeEscaped(s),t.data+=":";var i=a;return t=t.writeEscaped(i),t.data+=";\r\n",t}function t(e,t,n){var a=e.data,r=e.affix;t.data+="\r\n ",u.line=13;var s=(o=r.xindex)!==n?o:(o=a.xindex)!==n?o:e.resolveLooseUp(["xindex"]);t=t.writeEscaped(s),t.data+=":";var i=a;return t=t.writeEscaped(i),t.data+=";\r\n",t}function n(e,t,n){var a=e.data,r=e.affix;t.data+="\r\n ",u.line=20;var s=(o=r.xindex)!==n?o:(o=a.xindex)!==n?o:e.resolveLooseUp(["xindex"]);t=t.writeEscaped(s),t.data+=":";var i=a;return t=t.writeEscaped(i),t.data+=";\r\n",t}function a(a,s,i){var l=a.data,c=a.affix;s.data+='\r\n    <div class="',u.line=3;var d;d=p(r,a,{escape:1,params:["header"]},s,["getBaseCssClasses"]),s=s.writeEscaped(d),s.data+='"\r\n         style="\r\n',u.line=5,u.line=5;var f=(o=c.headerStyle)!==i?o:(o=l.headerStyle)!==i?o:a.resolveLooseUp(["headerStyle"]);s=h.call(r,a,{params:[f],fn:e},s),s.data+='\r\n">',u.line=8;var v=(o=c.headerContent)!==i?o:(o=l.headerContent)!==i?o:a.resolveLooseUp(["headerContent"]);s=s.write(v),s.data+='</div>\r\n\r\n    <div class="',u.line=10;var g;g=p(r,a,{escape:1,params:["body"]},s,["getBaseCssClasses"]),s=s.writeEscaped(g),s.data+='"\r\n         style="\r\n',u.line=12,u.line=12;var m=(o=c.bodyStyle)!==i?o:(o=l.bodyStyle)!==i?o:a.resolveLooseUp(["bodyStyle"]);s=h.call(r,a,{params:[m],fn:t},s),s.data+='\r\n">',u.line=15;var y=(o=c.bodyContent)!==i?o:(o=l.bodyContent)!==i?o:a.resolveLooseUp(["bodyContent"]);s=s.write(y),s.data+='</div>\r\n\r\n    <div class="',u.line=17;var x;x=p(r,a,{escape:1,params:["footer"]},s,["getBaseCssClasses"]),s=s.writeEscaped(x),s.data+='"\r\n         style="\r\n',u.line=19,u.line=19;var b=(o=c.footerStyle)!==i?o:(o=l.footerStyle)!==i?o:a.resolveLooseUp(["footerStyle"]);s=h.call(r,a,{params:[b],fn:n},s),s.data+='\r\n">',u.line=22;var C=(o=c.footerContent)!==i?o:(o=l.footerContent)!==i?o:a.resolveLooseUp(["footerContent"]);return s=s.write(C),s.data+='</div>\r\n    <div tabindex="0"></div>\r\n',s}{var o,r=this,i=r.root,l=r.buffer,c=r.scope,d=r.runtime,u=(r.name,r.pos),f=(c.data,c.affix,i.nativeCommands),v=i.utils,p=v.callFn,h=(v.callCommand,f.range,f.foreach,f.forin,f.each),g=(f["with"],f["if"],f.set,f.include,f.parse,f.extend,f.block);f.macro,f["debugger"]}l.data+="";var m;return d.extendTplName="./overlay",d.extendTplFn=s,l=l.write(m),l.data+="\r\n",u.line=2,l=g.call(r,c,{params:["ks-overlay-content"],fn:a},l)};return t.TPL_NAME=n.id||n.name,e}(),l=function(e){var t=s,n=y,a=new n(t);return e=function(){return a.render.apply(a,arguments)}}(),c=function(e){var t=i,n=y,a=new n(t);return e=function(){return a.render.apply(a,arguments)}}(),d=function(e){var t=x,n=b,s=C,i=a,c=o,d=r,u=_,f=l,v="hide",p={hide:v,destroy:"destroy"};return e=t.extend([u,n,i,s,c,d],{bindUI:function(){var e=this,t=e.get("closeBtn");t&&t.on("click",function(t){e.close(),t.preventDefault()})},close:function(){var e=this;return e[p[e.get("closeAction")]||v](),e}},{ATTRS:{handleGestureEvents:{value:!1},focusable:{value:!1},allowTextSelection:{value:!0},contentTpl:{value:f},closable:{value:!1,sync:0,render:1,parse:function(){return!!this.get("closeBtn")}},closeBtn:{selector:function(){return"."+this.getBaseCssClass("close")}},closeAction:{value:v},closeText:{value:"close",render:1},visible:{value:!1}},xclass:"overlay"})}(),u=function(e){function t(e,t,n){t=e.get(t),t.html(n)}function n(e){var t=this,n=e.keyCode;if(n===l){var a=t.$el,o=r(e.target),s=a.last();if(o.equals(a)&&e.shiftKey)s[0].focus(),e.halt();else if(o.equals(s)&&!e.shiftKey)t.focus(),e.halt();else if(o.equals(a)||a.contains(o))return;e.halt()}}var a=m,o=d,r=p,s=c,i=o.extend({beforeCreateDom:function(e){a.mix(e.elAttrs,{role:"dialog","aria-labelledby":"ks-stdmod-header-"+this.get("id")})},getChildrenContainerEl:function(){return this.get("body")},__afterCreateEffectGhost:function(e){var t=this,n=t.get("body");return e.all("."+t.get("prefixCls")+"stdmod-body").css({height:n.height(),width:n.width()}).html(""),e},handleKeyDownInternal:function(e){return this.get("escapeToClose")&&e.keyCode===r.Event.KeyCode.ESC?(("select"!==e.target.nodeName.toLowerCase()||e.target.disabled)&&(this.close(),e.halt()),void 0):(n.call(this,e),void 0)},_onSetVisible:function(e,t){var n=this,a=n.el;if(n.callSuper(e,t),e)n.__lastActive=a.ownerDocument.activeElement,n.focus(),a.setAttribute("aria-hidden","false");else{a.setAttribute("aria-hidden","true");try{n.__lastActive&&n.__lastActive.focus()}catch(o){}}},_onSetBodyContent:function(e){t(this,"body",e)},_onSetHeaderContent:function(e){t(this,"header",e)},_onSetFooterContent:function(e){t(this,"footer",e)}},{ATTRS:{focusable:{value:!0},contentTpl:{value:s},header:{selector:function(){return"."+this.getBaseCssClass("header")}},body:{selector:function(){return"."+this.getBaseCssClass("body")}},footer:{selector:function(){return"."+this.getBaseCssClass("footer")}},bodyStyle:{sync:0},footerStyle:{render:1},headerStyle:{render:1},headerContent:{value:"",sync:0,render:1,parse:function(){return this.get("header").html()}},bodyContent:{value:"",sync:0,render:1,parse:function(){return this.get("body").html()}},footerContent:{value:"",sync:0,render:1,parse:function(){return this.get("footer").html()}},closable:{value:!0},escapeToClose:{value:!0}},xclass:"dialog"}),l=r.Event.KeyCode.TAB;return e=i}(),f=function(e){function t(){var e,t=this,o=t.get("trigger");t.__mouseEnterPopup=function(n){a.call(t),e=l.later(function(){r.call(t,n),e=void 0},1e3*t.get("mouseDelay"))},o.on("mouseenter",t.__mouseEnterPopup),t._mouseLeavePopup=function(){e&&(e.cancel(),e=void 0),n.call(t)},o.on("mouseleave",t._mouseLeavePopup)}function n(){var e=this,t=1e3*e.get("mouseDelay");e._hiddenTimer=l.later(function(){s.call(e)},t)}function a(){var e=this;e._hiddenTimer&&(e._hiddenTimer.cancel(),e._hiddenTimer=void 0)}function o(){var e=this;e.__clickPopup=function(t){t.preventDefault(),e.get("toggle")?(e.get("visible")?s:r).call(e,t):r.call(e,t)},e.get("trigger").on("click",e.__clickPopup)}function r(e){var t=this;t.set("currentTrigger",c(e.target)),t.show()}function s(){this.set("currentTrigger",void 0),this.hide()}var i=d,l=m,c=p;return e=i.extend({initializer:function(){var e=this,n=e.get("trigger");n&&("mouse"===e.get("triggerType")?t.call(e):o.call(e))},bindUI:function(){var e=this,t=e.get("trigger");t&&"mouse"===e.get("triggerType")&&e.$el.on("mouseleave",n,e).on("mouseenter",a,e)},destructor:function(){var e=this,t=e.$el,o=e.get("trigger");o&&(e.__clickPopup&&o.detach("click",e.__clickPopup),e.__mouseEnterPopup&&o.detach("mouseenter",e.__mouseEnterPopup),e._mouseLeavePopup&&o.detach("mouseleave",e._mouseLeavePopup)),t&&t.detach("mouseleave",n,e).detach("mouseenter",a,e)}},{ATTRS:{trigger:{setter:function(e){return c(e)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:.1},toggle:{value:!1}},xclass:"popup"})}(),v=function(e){var t=d,n=u,a=f;return t.Dialog=n,t.Popup=a,e=t,t.version="1.0.1",e}(),n.exports=v});