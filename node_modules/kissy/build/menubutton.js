modulex.add("menubutton",["menu","xtemplate/runtime","button","component/extension/content-box","util","node"],function(e,t,n){var a,r,i,o,l,s,u=e("menu"),c=e("xtemplate/runtime"),d=e("button"),v=e("component/extension/content-box"),f=e("util"),h=e("node");a=function(e){var t=e=function a(e){{var t,a=this,n=a.root,r=a.buffer,i=a.scope,o=(a.runtime,a.name,a.pos),l=i.data,s=i.affix,u=n.nativeCommands,c=n.utils,d=c.callFn;c.callCommand,u.range,u.foreach,u.forin,u.each,u["with"],u["if"],u.set,u.include,u.parse,u.extend,u.block,u.macro,u["debugger"]}r.data+='<div class="';var v;v=d(a,i,{escape:1,params:["content"]},r,["getBaseCssClasses"]),r=r.writeEscaped(v),r.data+='">';var f=(t=s.content)!==e?t:(t=l.content)!==e?t:i.resolveLooseUp(["content"]);r=r.write(f),r.data+='</div>\r\n<div class="',o.line=2;var h;h=d(a,i,{escape:1,params:["dropdown"]},r,["getBaseCssClasses"]),r=r.writeEscaped(h),r.data+='">\r\n    <div class="',o.line=3;var p;return p=d(a,i,{escape:1,params:["dropdown-inner"]},r,["getBaseCssClasses"]),r=r.writeEscaped(p),r.data+='">\r\n    </div>\r\n</div>',r};return t.TPL_NAME=n.id||n.name,e}(),r=function(e){var t=u;return e=t.RadioItem.extend({},{ATTRS:{textContent:{}},xclass:"option"})}(),i=function(e){var t=a,n=c,r=new n(t);return e=function(){return r.render.apply(r,arguments)}}(),o=function(e){function t(e){e.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function n(e){if(e.target.isMenu){var t=this.el,n=e.newVal;t.setAttribute("aria-activedescendant",n&&n.el.id||"")}}var a=d,r=v,o=h.Event.KeyCode,l=i,s=f;return e=a.extend([r],{isMenuButton:1,decorateDom:function(e){var t=this,n=t.get("prefixCls"),a=e.one("."+n+"popupmenu"),r=a[0].ownerDocument.body;r.insertBefore(a[0],r.firstChild);var i=this.getComponentConstructorByNode(n,a);t.setInternal("menu",new i({srcNode:a,prefixCls:n}))},beforeCreateDom:function(e){s.mix(e.elAttrs,{"aria-expanded":"false","aria-haspopup":"true"})},_onSetCollapsed:function(e){var t=this,n=t.get("menu"),a=t.$el,r=t.getBaseCssClass("open");if(a[e?"removeClass":"addClass"](r).attr("aria-expanded",!e),e)n.hide();else if(!n.get("visible")){var i={node:a,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};if(s.mix(n.get("align"),i,!1),t.get("matchElWidth")){n.render();var o=n.get("el"),l=(parseInt(o.css("borderLeftWidth"),10)||0)+(parseInt(o.css("borderRightWidth"),10)||0);n.set("width",n.get("align").node[0].offsetWidth-l)}n.show(),a.attr("aria-haspopup",n.get("el").attr("id"))}},bindUI:function(){var e=this;e.on("afterHighlightedItemChange",n,e),e.on("click",t,e)},handleKeyDownInternal:function(e){var t=this,n=e.keyCode,a=String(e.type),r=t.get("menu");if(n===o.SPACE){if(e.preventDefault(),"keyup"!==a)return void 0}else if("keydown"!==a)return void 0;if(r.get("rendered")&&r.get("visible")){var i=r.handleKeyDownInternal(e);return n===o.ESC?(t.set("collapsed",!0),!0):i}return n===o.SPACE||n===o.DOWN||n===o.UP?(t.set("collapsed",!1),!0):void 0},handleClickInternal:function(){var e=this;e.set("collapsed",!e.get("collapsed"))},handleBlurInternal:function(e){var t=this;t.callSuper(e),t.set("collapsed",!0)},addItem:function(e,t){var n=this.get("menu");n.addChild(e,t)},removeItem:function(e,t){var n=this.get("menu");n.removeChild(e,t)},removeItems:function(e){var t=this.get("menu");t&&(t.removeChildren?t.removeChildren(e):t.children&&(t.children=[]))},getItemAt:function(e){var t=this.get("menu");return t.get("rendered")&&t.getChildAt(e)},_onSetDisabled:function(e){this.callSuper(e),e&&this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{handleGestureEvents:{value:!0},focusable:{value:!0},allowTextSelection:{value:!1},contentTpl:{value:l},matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{getter:function(e){return e=e||{},e.isControl||(e.xclass=e.xclass||"popupmenu",e=this.createComponent(e),this.setInternal("menu",e)),e},setter:function(e){e.isControl&&e.setInternal("parent",this)}},collapsed:{value:!0,render:1,sync:0}},xclass:"menu-button"})}(),l=function(e){function t(e){var t,a,r=e.get("menu"),i=r.children||r.get&&r.get("children")||[],o=e.get("value");for(a=0;a<i.length;a++)if(t=i[a],n(t)===o)return t;return null}function n(e){var t;return e&&(e.get?void 0===(t=e.get("value"))&&(t=e.get("textContent")||e.get("content")):void 0===(t=e.value)&&(t=e.textContent||e.content)),t}function a(e){var t=e.get("menu"),a=e.get("value"),r=t&&t.get&&t.get("children");c.each(r,function(e){e&&e.set&&e.set("selected",n(e)===a)})}function r(e){var n=this,a=t(n),r=n.get("menu");if(e.target===r){var i=a||r.getChildAt(0);i&&i.set("highlighted",!0),a&&a.set("selected",!0)}}function i(e){var n=t(e),a=n&&(n.textContent||n.get&&n.get("textContent")),r=n&&(n.content||n.get&&n.get("content"));e.set("content",a||r||e.get("defaultCaption"))}function l(e){var t=this,a=e.target;if(a.isMenuItem){var r=n(a),i=t.get("value");t.set("value",r),r!==i&&t.fire("change",{prevVal:i,newVal:r})}}var s=h,u=o,c=f,d=u.extend({bindUI:function(){this.on("click",l,this),this.on("show",r,this)},removeItems:function(){var e=this;e.callSuper.apply(e,arguments),e.set("value",null)},removeItem:function(e,t){var n=this;n.callSuper(e,t),e.get("value")===n.get("value")&&n.set("value",null)},_onSetValue:function(){var e=this;a(e),i(e)},_onSetDefaultCaption:function(){i(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(e,t){e=s(e),t=t||{},t.elBefore=e;var n,a,r=[],i=null,o=e.val(),l=e.all("option");if(l.each(function(e){var t={xclass:"option",content:e.text(),elCls:e.attr("class"),value:e.val()};o===e.val()&&(i={content:t.content,value:t.value}),r.push(t)}),t.menu=t.menu||t.menuCfg||{},t.menu.children=r,delete t.menuCfg,a=new d(c.mix(t,i)).render(),n=e.attr("name")){var u=s('<input type="hidden" name="'+n+'" value="'+o+'">').insertBefore(e,void 0);a.on("afterValueChange",function(e){u.val(e.newVal||"")})}return e.remove(),a},xclass:"select"});return e=d}(),s=function(e){var t=o,n=l;return t.Select=n,t.Option=r,e=t,t.version="1.0.2",e}(),n.exports=s});